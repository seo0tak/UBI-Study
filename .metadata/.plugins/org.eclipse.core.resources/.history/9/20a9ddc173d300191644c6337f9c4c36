package ubi.controller;

import javax.validation.Valid;

import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.beans.factory.annotation.Qualifier;
import org.springframework.stereotype.Controller;
import org.springframework.ui.Model;
import org.springframework.validation.BindingResult;
import org.springframework.web.bind.annotation.ModelAttribute;
import org.springframework.web.bind.annotation.RequestMapping;
import org.springframework.web.bind.annotation.RequestMethod;
import org.springframework.web.bind.annotation.RequestParam;
import org.springframework.web.servlet.ModelAndView;

import ubi.model.BoardBean;
import ubi.model.BoardDao;

@Controller
public class refController {
	private static final String getPage = "refForm";
	private static final String gotoPage = "redirect:/list.brd";
	private static final String command = "/refForm.brd";	
	
	@Autowired
	@Qualifier("myBoardDao")
	private BoardDao dao;
	
	@RequestMapping(value=command)
	public String doActionGet(@RequestParam(value="pmkey",required=true) int pmkey ,Model model){
	
		BoardBean bean =  dao.GetData( pmkey );
		model.addAttribute("bean" , bean);
		return getPage; 
	}
	
	@RequestMapping(value=command, method=RequestMethod.POST)
	public ModelAndView doActionGet(@ModelAttribute("board") @Valid BoardBean board, BindingResult result){
		ModelAndView mav = new ModelAndView();
		if(result.hasErrors())
		{
			System.out.println("유효성검사 오류");
			mav.setViewName(getPage);
			return mav;
		}
		System.out.println("ctrl : "+board.getRef());
		dao.insertRef(board);
		
		mav.setViewName(gotoPage);
		return mav;
	}
	
}
